% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runGLIPH.R
\name{runGLIPH}
\alias{runGLIPH}
\alias{turbo_gliph}
\alias{gliph2}
\alias{gliph_combined}
\title{Run the GLIPH or GLIPH2 TCR clustering algorithm}
\usage{
runGLIPH(
  cdr3_sequences,
  method = c("gliph2", "gliph1", "custom"),
  chains = "TRB",
  result_folder = "",
  refdb_beta = "human_v2.0_CD48",
  v_usage_freq = NULL,
  cdr3_length_freq = NULL,
  ref_cluster_size = "original",
  sim_depth = 1000,
  lcminp = 0.01,
  lcminove = c(1000, 100, 10),
  kmer_mindepth = 3,
  accept_CF = TRUE,
  min_seq_length = 8,
  gccutoff = NULL,
  structboundaries = TRUE,
  boundary_size = 3,
  motif_length = c(2, 3, 4),
  local_similarities = TRUE,
  global_similarities = TRUE,
  local_method = NULL,
  global_method = NULL,
  clustering_method = NULL,
  scoring_method = NULL,
  cluster_min_size = 2,
  hla_cutoff = 0.1,
  n_cores = 1,
  motif_distance_cutoff = 3,
  discontinuous_motifs = FALSE,
  all_aa_interchangeable = FALSE,
  boost_local_significance = FALSE,
  global_vgene = FALSE,
  cdr3_len_stratify = FALSE,
  vgene_stratify = FALSE,
  public_tcrs = TRUE,
  vgene_match = "none",
  scoring_sim_depth = 1000,
  verbose = TRUE
)

turbo_gliph(cdr3_sequences, ...)

gliph2(cdr3_sequences, ...)

gliph_combined(cdr3_sequences, ...)
}
\arguments{
\item{cdr3_sequences}{Input data containing CDR3b amino acid sequences.
Accepts a character vector, a \code{data.frame} with columns described
below, a \code{Seurat} object, a \code{SingleCellExperiment} object, or
a list returned by \code{scRepertoire::combineTCR()/combineBCR()}.

When a \code{data.frame} is supplied, the following column names are
recognized (alternative names in parentheses are mapped automatically):
\describe{
\item{CDR3b}{(cdr3, cdr3_aa, CDR3.beta, junction_aa) Required.
CDR3 beta-chain amino acid sequences.}
\item{TRBV}{(v_gene, v.gene, Vgene, v_call) Optional. V-gene usage.}
\item{patient}{(sample, donor, sample_id) Optional. Donor index.}
\item{HLA}{(hla, HLA_alleles) Optional. HLA alleles, comma-separated.}
\item{counts}{(frequency, clone_count, cloneCount) Optional. Clone
frequency.}
}}

\item{method}{Character. Algorithm preset to use.
\itemize{
\item{\code{"gliph2"}}{ Fisher-based local and global similarity,
GLIPH2-style isolated clustering and scoring.}
\item{\code{"gliph1"}}{ Repeated random sampling for local similarity,
Hamming distance cutoff for global similarity, GLIPH1-style
connected-component clustering.}
\item{\code{"custom"}}{ All parameters can be set independently.}
}
\strong{Default:} \code{"gliph2"}}

\item{chains}{Character. Chain type for extraction from \code{Seurat} or
\code{SingleCellExperiment} objects via \code{immApex::getIR()}.
\strong{Default:} \code{"TRB"}}

\item{result_folder}{Character. Path to output folder. If \code{""},
results are not saved to disk. \strong{Default:} \code{""}}

\item{refdb_beta}{Character or \code{data.frame}. Reference database for
motif enrichment testing. Built-in databases include
\code{"human_v1.0_CD4"}, \code{"human_v1.0_CD8"},
\code{"human_v1.0_CD48"}, \code{"human_v2.0_CD4"},
\code{"human_v2.0_CD8"}, \code{"human_v2.0_CD48"},
\code{"mouse_v1.0_CD4"}, \code{"mouse_v1.0_CD8"},
\code{"mouse_v1.0_CD48"}, and the legacy alias
\code{"gliph_reference"} (= \code{"human_v1.0_CD48"}).
Alternatively, supply a \code{data.frame} with CDR3b in the first
column and optional V-gene in the second.
See \code{\link{reference_list}} for details.
\strong{Default:} \code{"human_v2.0_CD48"}}

\item{v_usage_freq}{\code{data.frame} or \code{NULL}. V-gene frequencies
for scoring. If \code{NULL}, built-in defaults are used.
\strong{Default:} \code{NULL}}

\item{cdr3_length_freq}{\code{data.frame} or \code{NULL}. CDR3 length
frequencies for scoring. If \code{NULL}, built-in defaults are used.
\strong{Default:} \code{NULL}}

\item{ref_cluster_size}{Character. Reference cluster size strategy.
\itemize{
\item{\code{"original"}}{ Use the original sample size.}
\item{\code{"simulated"}}{ Use simulated cluster sizes.}
}
\strong{Default:} \code{"original"}}

\item{sim_depth}{Integer. Simulation depth for repeated random sampling
(local method \code{"rrs"}) or cluster scoring.
\strong{Default:} \code{1000}}

\item{lcminp}{Numeric. Local convergence maximum p-value threshold.
\strong{Default:} \code{0.01}}

\item{lcminove}{Numeric vector. Local convergence minimum fold-change
per motif length (lengths 2, 3, and 4 respectively).
\strong{Default:} \code{c(1000, 100, 10)}}

\item{kmer_mindepth}{Integer. Minimum number of kmer observations
required to consider a motif.
\strong{Default:} \code{3}}

\item{accept_CF}{Logical. If \code{TRUE}, accept only sequences starting
with C and ending with F.
\strong{Default:} \code{TRUE}}

\item{min_seq_length}{Integer. Minimum CDR3b sequence length to retain.
\strong{Default:} \code{8}}

\item{gccutoff}{Numeric or \code{NULL}. Global convergence Hamming distance
cutoff (used when \code{global_method = "cutoff"}). If \code{NULL},
the cutoff is auto-selected based on sample size.
\strong{Default:} \code{NULL}}

\item{structboundaries}{Logical. If \code{TRUE}, trim structural
boundaries from CDR3b sequences before motif search.
\strong{Default:} \code{TRUE}}

\item{boundary_size}{Integer. Number of positions to trim from each end
when \code{structboundaries = TRUE}.
\strong{Default:} \code{3}}

\item{motif_length}{Numeric vector. Motif lengths to search.
\strong{Default:} \code{c(2, 3, 4)}}

\item{local_similarities}{Logical. If \code{TRUE}, search for locally
similar CDR3b sequences.
\strong{Default:} \code{TRUE}}

\item{global_similarities}{Logical. If \code{TRUE}, search for globally
similar CDR3b sequences.
\strong{Default:} \code{TRUE}}

\item{local_method}{Character or \code{NULL}. Method for local similarity
detection. If \code{NULL}, set by the \code{method} preset.
\itemize{
\item{\code{"fisher"}}{ Fisher exact test for motif enrichment.}
\item{\code{"rrs"}}{ Repeated random sampling.}
}
\strong{Default:} \code{NULL}}

\item{global_method}{Character or \code{NULL}. Method for global similarity
detection. If \code{NULL}, set by the \code{method} preset.
\itemize{
\item{\code{"fisher"}}{ Fisher exact test for struct enrichment.}
\item{\code{"cutoff"}}{ Hamming distance cutoff.}
}
\strong{Default:} \code{NULL}}

\item{clustering_method}{Character or \code{NULL}. Clustering strategy.
If \code{NULL}, set by the \code{method} preset.
\itemize{
\item{\code{"GLIPH1.0"}}{ Connected-component clustering.}
\item{\code{"GLIPH2.0"}}{ Isolated clustering with merging.}
}
\strong{Default:} \code{NULL}}

\item{scoring_method}{Character or \code{NULL}. Scoring strategy.
If \code{NULL}, set by the \code{method} preset.
\itemize{
\item{\code{"GLIPH1.0"}}{ GLIPH1-style scoring.}
\item{\code{"GLIPH2.0"}}{ GLIPH2-style scoring.}
}
\strong{Default:} \code{NULL}}

\item{cluster_min_size}{Integer. Minimum number of unique CDR3b sequences
required to retain a convergence group.
\strong{Default:} \code{2}}

\item{hla_cutoff}{Numeric. Significance cutoff for HLA enrichment testing.
\strong{Default:} \code{0.1}}

\item{n_cores}{Integer or \code{NULL}. Number of cores for parallel
processing. If \code{NULL}, the number of available cores is
auto-detected.
\strong{Default:} \code{1}}

\item{motif_distance_cutoff}{Integer. Maximum positional distance between
shared motifs for two CDR3b sequences to be linked (GLIPH2).
\strong{Default:} \code{3}}

\item{discontinuous_motifs}{Logical. If \code{TRUE}, allow discontinuous
motif patterns during local similarity search.
\strong{Default:} \code{FALSE}}

\item{all_aa_interchangeable}{Logical. If \code{FALSE}, BLOSUM62 filtering
is applied to global similarities, restricting substitutions to
biochemically similar amino acids.
\strong{Default:} \code{FALSE}}

\item{boost_local_significance}{Logical. If \code{TRUE}, boost local
p-values using germline N-nucleotide insertion information.
\strong{Default:} \code{FALSE}}

\item{global_vgene}{Logical. If \code{TRUE}, restrict global similarity
edges to pairs sharing the same V-gene.
\strong{Default:} \code{FALSE}}

\item{cdr3_len_stratify}{Logical. If \code{TRUE}, stratify random
subsamples by CDR3 length (used with \code{local_method = "rrs"}).
\strong{Default:} \code{FALSE}}

\item{vgene_stratify}{Logical. If \code{TRUE}, stratify random subsamples
by V-gene usage (used with \code{local_method = "rrs"}).
\strong{Default:} \code{FALSE}}

\item{public_tcrs}{Logical or character. Controls cross-donor edge
filtering. For \code{method = "gliph1"} or \code{"gliph2"}: if
\code{FALSE}, restrict edges to same donor. For \code{method = "custom"}:
\itemize{
\item{\code{"all"}}{ Allow cross-donor edges for all similarity types.}
\item{\code{"local"}}{ Allow cross-donor edges for local only.}
\item{\code{"global"}}{ Allow cross-donor edges for global only.}
\item{\code{"none"}}{ Restrict all edges to same donor.}
}
\strong{Default:} \code{TRUE}}

\item{vgene_match}{Character. V-gene matching requirement for custom
clustering.
\itemize{
\item{\code{"none"}}{ No V-gene matching required.}
\item{\code{"local"}}{ Require V-gene match for local edges.}
\item{\code{"global"}}{ Require V-gene match for global edges.}
\item{\code{"all"}}{ Require V-gene match for all edges.}
}
\strong{Default:} \code{"none"}}

\item{scoring_sim_depth}{Integer. Simulation depth used specifically for
convergence group scoring.
\strong{Default:} \code{1000}}

\item{verbose}{Logical. If \code{TRUE}, print progress messages to the
console.
\strong{Default:} \code{TRUE}}

\item{...}{Arguments passed to \code{runGLIPH()} by the deprecated
wrapper functions.}
}
\value{
A \code{list} with the following elements:
\describe{
\item{\code{sample_log}}{\code{data.frame}. Motif counts per simulation
iteration (only present when \code{local_method = "rrs"}).}
\item{\code{motif_enrichment}}{\code{list} with two elements:
\describe{
\item{\code{selected_motifs}}{\code{data.frame} of significantly
enriched motifs passing all thresholds.}
\item{\code{all_motifs}}{\code{data.frame} of all evaluated motifs
with enrichment statistics.}
}}
\item{\code{global_enrichment}}{\code{list}. Global struct enrichment
results (GLIPH2 only; \code{NULL} otherwise).}
\item{\code{connections}}{\code{data.frame}. Edge list representing the
clone network.}
\item{\code{cluster_properties}}{\code{data.frame}. Convergence group
properties and scores.}
\item{\code{cluster_list}}{Named \code{list} of \code{data.frame}
objects with per-cluster member details.}
\item{\code{parameters}}{\code{list}. All input parameters used for the
run.}
}
}
\description{
Unified entry point for the GLIPH/GLIPH2 algorithm for grouping T cell
receptors by antigen specificity. The function identifies locally and
globally similar CDR3b sequences, clusters them into convergence groups,
and scores each group for biological relevance.
}
\section{Deprecated Functions}{

\code{turbo_gliph}, \code{gliph2}, and \code{gliph_combined} are
deprecated aliases. Use \code{runGLIPH()} instead.
}

\examples{
\dontrun{
utils::data("gliph_input_data")
res <- runGLIPH(
  cdr3_sequences = gliph_input_data[seq_len(200), ],
  method = "gliph2",
  sim_depth = 50,
  n_cores = 1
)
}

}
\references{
Glanville, J. et al. (2017). Identifying specificity groups in the
T cell receptor repertoire. \emph{Nature}, 547, 94--98.
\doi{10.1038/nature22976}

Huang, H. et al. (2020). Analyzing the Mycobacterium tuberculosis immune
response by T-cell receptor clustering with GLIPH2 and genome-wide antigen
screening. \emph{Nature Biotechnology}, 38, 1194--1202.
\doi{10.1038/s41587-020-0505-4}
}
